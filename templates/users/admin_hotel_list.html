{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
  <h2>Glutensiz Oteller</h2>
  <form method="get" class="d-flex flex-wrap gap-2 align-items-center" style="min-width:250px;">
    <div class="input-group">
      <input type="text" name="q" value="{{ request.GET.q|default:'' }}" class="form-control" placeholder="İsim, iletişim veya adres ara...">
    </div>
    <select name="city" class="form-select" id="hotel-filter-city" style="min-width:120px;"></select>
    <select name="district" class="form-select" id="hotel-filter-district" style="min-width:120px;"></select>
    <select name="is_approved" class="form-select" style="min-width:120px;">
      <option value="">Hepsi</option>
      <option value="true" {% if request.GET.is_approved == 'true' %}selected{% endif %}>Onaylı</option>
      <option value="false" {% if request.GET.is_approved == 'false' %}selected{% endif %}>Onaysız</option>
    </select>
    <button class="btn btn-outline-secondary" type="submit">Filtrele</button>
    <button class="btn btn-outline-danger" type="button" onclick="window.location.href=window.location.pathname">Filtreleri Temizle</button>
  </form>
  <a href="{% url 'admin_hotel_create' %}" class="btn btn-success">Yeni Ekle</a>
</div>
<table class="table table-striped">
  <thead>
    <tr>
      <th>Ekleyen</th>
      <th>Otel Adı</th>
      <th>İl/İlçe</th>
      <th>Onaylı mı?</th>
      <th>İşlemler</th>
    </tr>
  </thead>
  <tbody>
    {% for hotel in hotels %}
    <tr>
      <td>{% if hotel.added_by %}{{ hotel.added_by }}{% else %}—{% endif %}</td>
      <td>{{ hotel.name }}</td>
      <td>{{ hotel.city }}{% if hotel.district %} / {{ hotel.district }}{% endif %}</td>
      <td>{% if hotel.is_approved %}Evet{% else %}Hayır{% endif %}</td>
      <td>
        <a href="{% url 'admin_hotel_update' hotel.pk %}" class="btn btn-sm btn-primary">Düzenle</a>
        <a href="{% url 'admin_hotel_delete' hotel.pk %}" class="btn btn-sm btn-danger">Sil</a>
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="5">Kayıt bulunamadı.</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/style.js' %}"></script>
<script>
// Fill city filter
function fillHotelCityFilter() {
  const citySelect = document.getElementById('hotel-filter-city');
  if (citySelect) {
    citySelect.innerHTML = '<option value="">Tüm Şehirler</option>';
    if (window.turkishCities) {
      window.turkishCities.forEach(function(city) {
        const option = document.createElement('option');
        option.value = city;
        option.text = city;
        if (city === "{{ request.GET.city|default:'' }}") option.selected = true;
        citySelect.appendChild(option);
      });
    }
  }
}
// Fill district filter based on city
function fillHotelDistrictFilter() {
  const citySelect = document.getElementById('hotel-filter-city');
  const districtSelect = document.getElementById('hotel-filter-district');
  districtSelect.innerHTML = '<option value="">Tüm İlçeler</option>';
  if (citySelect && citySelect.value && window.cityDistricts && window.cityDistricts[citySelect.value]) {
    window.cityDistricts[citySelect.value].forEach(function(district) {
      const option = document.createElement('option');
      option.value = district;
      option.text = district;
      if (district === "{{ request.GET.district|default:'' }}") option.selected = true;
      districtSelect.appendChild(option);
    });
  }
}
document.addEventListener('DOMContentLoaded', function() {
  fillHotelCityFilter();
  fillHotelDistrictFilter();
  document.getElementById('hotel-filter-city').addEventListener('change', fillHotelDistrictFilter);
});
</script>
{% endblock %} 